---
title: "analysis_EVE_model_body"
author: "Wenwei Fei"
date: "01/09/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(data.table)
library(tidyverse)
library(ggiraph)
library(scales)
filepath <- "D:/Projects/EVE/Eve/"
df <- fread(paste0(filepath,"df_all_31_08.csv"))
df_test <- df
df_test <- df_test[!title %in% c("",is.na(title))] # check blank and NA
```

```{r split the model and series/badge}
# consider each brands differently
df_test[,.N,make]
```

```{r BMW}
df_bmw <- df_test[make == "BMW"]
df_bmw[,.N, badge_series]
# separate model & badge_series
df_bmw[, badge_series := str_remove_all(model_badge, model)]
## badge_series are too many!! 
## 
gg_bmw_body_medP <- df_test[make == "BMW", .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "BMW median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r BMW medprice model body}
df_bmw[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_bmw_body_model_medP <- df_bmw[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "BMW stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
# column plot
girafe(ggobj = gg_bmw_body_medP)
```

```{r}
# stacked column plot
girafe(ggobj = gg_bmw_body_model_medP)

```

1: In BMW, body type hatch and wagon have the lowest median price around `$40,000`, which is `$10,000` lower than the third lowest body type convertible. 

2: In every model category, the highest/luxury level (8 series, i8, M8 and X7)  has the highest median price in its category of models. X is the only model making SUV, and wagon only appears in 3 Series and 5 Series.

3: Series model covers five body types except for SUV. The buyer who has a limited budget could consider the Series model first. However, the buyer who only interests in the BMW SUV body type should only pay attention to the X model.

```{r Holden}
df_holden <- df_test[make == "Holden" & body_adj != "Van"]

gg_holden_body_medP <- df_holden[, .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "Holden median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_holden_body_medP)
```

```{r Holden medprice model body}
df_holden[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_holden_body_model_medP <- df_holden[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "Holden stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_holden_body_model_medP)
```

1: In Holden, hatch has the lowest median price among body types, which is around `$13,000`. Ute and Cab Chassis have the top two highest med price. In my memory, these two body types are popular and economical selections for many handymen and builders.

2: Holden's models and body types are messy. Some models (like Acadia & Trailblazer, Calais & Commodore) have similar pricing segments and the same body types. I wonder why Holden made so many model names and only a few of them are popular in the market like Commodore, Ute, Colorado and Cruze. 



```{r Mazda}
df_mazda <- df_test[make == "Mazda"]

gg_mazda_body_medP <- df_mazda[, .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "Mazda median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_mazda_body_medP)
```

```{r Mazda medprice model body}
df_mazda[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_mazda_body_model_medP <- df_mazda[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "Mazda stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_mazda_body_model_medP)
```

1: Mazda pricing segments can be put into three groups:
	a: Hatch, Sedan and wagon ($ 20,000 - 22,000)
	b: SUV, Cab Chassis and Convertible ($ 30,000 - 34,000)
	c: Coupe and Ute ($ 38,000 to 40,000) 
	
2: Mazda pricing strategy is a lot tidy compare to Holden's. Models 2,3 and 6 target the family general using in the first body type group. CX model provides SUV cars only with various price ranges. 



```{r Volkswagen}
df_volkswagen <- df_test[make == "Volkswagen"]

gg_volkswagen_body_medP <- df_volkswagen[, .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "Volkswagen median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_volkswagen_body_medP)
```

```{r Volkswagen medprice model body}
df_volkswagen[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_volkswagen_body_model_medP <- df_volkswagen[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "Volkswagen stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_volkswagen_body_model_medP)
```

1: Volkswagen covers almost every body types! The bus has the highest med price at 77,000.



```{r Toyota}
df_toyota <- df_test[make == "Toyota"]

gg_toyota_body_medP <- df_toyota[, .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "Toyota median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_toyota_body_medP)
```

```{r Toyota medprice model body}
df_toyota[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_toyota_body_model_medP <- df_toyota[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "Toyota stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_toyota_body_model_medP)
```




```{r Nissan}
df_Nissan <- df_test[make == "Nissan"]

gg_Nissan_body_medP <- df_Nissan[, .(Median_price = median(price_adj)), .(make,body_adj)][order(Median_price)] %>% 
  ggplot() +
  geom_col_interactive(aes(x = body_adj, y = Median_price, fill = body_adj,tooltip = round(Median_price, 2), data_id = round(Median_price, 2))) +
  #theme_minimal()+
  labs(x = "Body type", y = "Median Price", title = "Toyota median price in each body type", fill = "Body Type") +
  scale_fill_brewer(palette = "Paired")+# try palette
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_Nissan_body_medP)
```

```{r Nissan medprice model body}
df_Nissan[, .(med_price = median(price_adj)), .(model,body_adj)]

gg_Nissan_body_model_medP <- df_Nissan[, .(med_price = median(price_adj)), .(model,body_adj)] %>% 
  ggplot()+
  geom_col_interactive(aes(x = model, y = med_price, fill = body_adj, 
                           tooltip = med_price, data_id = med_price))+
  labs(x = "Model", y ="stacked median price", title = "Toyota stacked median price betwen body type and model", fill = "Body Type")+
  scale_fill_brewer(palette = "Paired")+
  theme(axis.text.x = element_text(angle = 90, vjust =0.5))+
  scale_y_continuous(labels = comma) # change y axis number format
```

```{r}
girafe(ggobj = gg_Nissan_body_model_medP)
```


